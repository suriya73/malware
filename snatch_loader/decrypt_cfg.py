import struct
import sys

from Crypto.Cipher import ARC4


def generate_key(seed):
    pieces = []

    math1 = 0xC0DE1EE7
    for i in range(6):
        v6 = math1
        math1 = (math1 - 0x21524111) & 0xffffffff
        math2 = (v6 ^ seed) & 0xffffffff

        pieces.append(math2)

    key = "%08X%X%X%X%08X%X" % (pieces[0], pieces[1] & 0xffff, pieces[2] & 0xffff, pieces[3] & 0xffff, pieces[4], pieces[5] & 0xffff)

    return key
        

fp = open(sys.argv[1], "rb")
idata = fp.read()
fp.close()

seed = struct.unpack("I", idata[0:4])[0]
key = generate_key(seed)
enc_buf = idata[4:]

rc4 = ARC4.new(key)
config = rc4.decrypt(enc_buf)

print config
import pdb; pdb.set_trace()
